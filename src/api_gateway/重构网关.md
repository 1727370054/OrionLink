# 网关重构
## 鉴权流程
- 1 接收消息
- 2 验证鉴权
    本地缓存验证
    鉴权服务器验证
- 3 转发消息
    需要考虑的问题
    验证用户身份（token）
    验证用户权限 （是否有此消息权限）
    用户权限的管理
    配置中心修改权限
- 4 权限设计
    用户 ==》角色 ==》消息权限
- 5 角色设计
    默认角色
        default
    管理员角色
        admin
        暂时不考虑
    超级管理员角色
        root
        只有一个用户 有全部权限，root
角色和权限管理，这部分不做，实际应用用web开发
，所以我们项目中直接操作数据库
暂定只考虑用root用户处理

# 网关消息转发流程
## 涉及到资源
- 客户端请求消息
- 鉴权请求消息
- 鉴权回复消息
- 微服务回复消息
- 客户端handle
  - 客户端断开后会delete


# 消息转发流程

# 消息队列设计
## 发送消息
    加入list（互斥）
## 接收消息
    查找list（互斥）
## 分发消息处理
    分发线程
## 订阅消息


# 消息的状态
- 1 待鉴权
  - XServiceHandle ReadCB收到消息
- 2 鉴权失败 （token过期或者不存在）
- 3 待转发
- 4 转发失败 （微服务异常）
- 4 待响应
- 5 响应超时
- 6 已回复 

# 消息的操作
- 鉴权处理
  - 验证本地鉴权
  - 发送鉴权
  - 鉴权超时，移除鉴权任务，返回客户端超时消息
    - 鉴权处理线程，
  - 鉴权成功，添加转发任务
  - 转发回复超时，返回微服务处理超时
  - 


# 消息回调
- 鉴权回调
    - 调用 evuser_trigger
- 消息回调
    - 
